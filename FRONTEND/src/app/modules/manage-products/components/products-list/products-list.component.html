<section class="section-actions">
  <div class="button-container d-flex align-items-end justify-content-end">
    <button pButton type="button"
            class="clear-button button-tertiary"
            [label]="'portal.components.product.list.table.buttons.clearFilters' | translate"
            icon="icon mi-close"
            [disabled]="asyncOperationsStatus.isProcessingRequest || itemSelected"
            (click)="clearFilters()"></button>
    <button pButton type="button"
            class="clear-button button-secondary"
            [label]="'portal.components.product.list.table.buttons.delete' | translate"
            icon="icon mi-delete"
            [disabled]="asyncOperationsStatus.isProcessingRequest || itemSelected || !selectedProducts.length"
            (click)="confirmDeletion()"></button>
    <button pButton type="button"
            class="create-button button-primary"
            [label]="'portal.components.product.list.table.buttons.create' | translate"
            icon="icon mi-add"
            [disabled]="asyncOperationsStatus.isProcessingRequest || itemSelected"
            (click)=navigateToCreateProduct()></button>
  </div>
</section>
<section class="section-list">
  <div class="table-wrapper">
    <p-table responsiveLayout="scroll" [value]="products" [loading]="true" [showLoader]="false" dataKey="id"
             [(selection)]="selectedProducts">
      <ng-template pTemplate="header">
        <tr>
          <th class="table-checkbox">
            <p-tableHeaderCheckbox [disabled]="itemSelected"></p-tableHeaderCheckbox>
          </th>
          <!-- Column Header: Product -->
          <td>
            <div class="d-flex flex-column">
              <div class="d-flex justify-content-between align-items-center">
                <span [translate]="'portal.components.product.list.table.headers.product'"></span>
                <div class="sorting-options d-flex">
                  <i class="pi pi-sort-alpha-up"
                     [ngClass]="{
                         'disabled': asyncOperationsStatus.isProcessingRequest || !productsCount || itemSelected,
                         'enabled': !asyncOperationsStatus.isProcessingRequest,
                         'active': productFilter.sortOrder === SORT_ORDERS.ASC
                                   && productFilter.sortBy === SORT_BYS.NAME
                       }"
                     (click)="loadProducts(false, SORT_BYS.NAME, SORT_ORDERS.ASC)"></i>
                  <i class="pi pi-sort-alpha-down"
                     [ngClass]="{
                         'disabled': asyncOperationsStatus.isProcessingRequest || !productsCount || itemSelected,
                         'enabled': !asyncOperationsStatus.isProcessingRequest,
                         'active': productFilter.sortOrder === SORT_ORDERS.DESC
                                   && productFilter.sortBy === SORT_BYS.NAME
                       }"
                     (click)="loadProducts(false, SORT_BYS.NAME, SORT_ORDERS.DESC)"></i>
                </div>
              </div>
              <span class="search-box p-input-icon-right mt-2">
                  <input pInputText type="text"
                         [disabled]="asyncOperationsStatus.isProcessingRequest || itemSelected"
                         [(ngModel)]="productFilter.name"
                         [placeholder]="'portal.general.table.search' | translate"
                         (keydown.enter)="loadProducts(true)">
                  <i role="button" class="pi pi-search" (click)="loadProducts(true)"></i>
                </span>
            </div>
          </td>
          <!-- Column Header: Value -->
          <td>
            <div class="d-flex flex-column">
              <div class="d-flex justify-content-between align-items-center">
                <span [translate]="'portal.components.product.list.table.headers.value'"></span>
                <div class="sorting-options d-flex">
                  <i class="pi pi-sort-alpha-up"
                     [ngClass]="{
                         'disabled': asyncOperationsStatus.isProcessingRequest || !productsCount || itemSelected,
                         'enabled': !asyncOperationsStatus.isProcessingRequest,
                         'active': productFilter.sortOrder === SORT_ORDERS.ASC
                                   && productFilter.sortBy === SORT_BYS.VALUE
                       }"
                     (click)="loadProducts(false, SORT_BYS.VALUE, SORT_ORDERS.ASC)"></i>
                  <i class="pi pi-sort-alpha-down"
                     [ngClass]="{
                         'disabled': asyncOperationsStatus.isProcessingRequest || !productsCount || itemSelected,
                         'enabled': !asyncOperationsStatus.isProcessingRequest,
                         'active': productFilter.sortOrder === SORT_ORDERS.DESC
                                   && productFilter.sortBy === SORT_BYS.VALUE
                       }"
                     (click)="loadProducts(false, SORT_BYS.VALUE, SORT_ORDERS.DESC)"></i>
                </div>
              </div>
              <span class="search-box p-input-icon-right mt-2">
                  <input pInputText type="text"
                         [disabled]="asyncOperationsStatus.isProcessingRequest || itemSelected"
                         [(ngModel)]="productFilter.value"
                         [placeholder]="'portal.general.table.search' | translate"
                         (keydown.enter)="loadProducts(true)">
                  <i role="button" class="pi pi-search" (click)="loadProducts(true)"></i>
                </span>
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="loadingbody">
        <tr *ngIf="asyncOperationsStatus.isProcessingRequest">
          <td colspan="4" class="text-center h-100">
            <p-progressSpinner class="default-spinner"></p-progressSpinner>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-product>
        <tr [pSelectableRow]="product"
            *ngIf="!asyncOperationsStatus.isProcessingRequest">
          <td class="table-checkbox">
            <p-tableCheckbox [value]="product" [disabled]="itemSelected"></p-tableCheckbox>
          </td>
          <td>{{product.name}}</td>
          <td>
            {{product.value | currencyExchange | currency : currencyCode}}
            <button type="button" pButton icon="icon mi-more_vert" class="float-right"
                    (click)="showItemDetails(product)"></button>
          </td>
        </tr>
      </ng-template>
    </p-table>
    <p-paginator dropdownAppendTo="self"
                 [showCurrentPageReport]="true"
                 [rows]="DEFAULT_PAGINATION_PARAMETERS.pageSize"
                 [rowsPerPageOptions]="DEFAULT_PAGINATION_PARAMETERS.pageOptions"
                 [totalRecords]="productsCount"
                 [currentPageReportTemplate]="'portal.general.table.paginator' | translate"
                 (onPageChange)="changePagination($event)">
    </p-paginator>
  </div>
</section>

<section class="hidden-scrollbar" *ngIf="itemSelected">
  <p-sidebar [visible]="itemSelected" position="right" transitionOptions="200ms" [modal]="false" [baseZIndex]="100">
    <app-products-details
      [productId]="itemSelected.id"
      (closeDetailsEvent)="closeItemDetails($event)"
      (loadProducts)="loadProducts(true)"
    >
    </app-products-details>
  </p-sidebar>
</section>

<p-toast></p-toast>
<p-confirmDialog
  transitionOptions="200ms"
  acceptIcon="icon mi-check"
  rejectIcon="icon mi-close"
  key="deleteProductsConfirmDialog"
>
  <ng-template pTemplate="header">
    <div class="custom-confirm-dialog">
      <h3 [translate]="'portal.components.product.list.dialog.productDelete.title'"></h3>
      <div class="text-label-medium mt-2">
        <span class="dialog-description ml-2 icon mi-warning-big"
              [translate]="'portal.components.product.list.dialog.productDelete.description'"></span>
        <div class="items-list">
          <ul class="mt-3">
            <li class="icon mi-arrow_right"
                *ngFor="let product of selectedProducts | slice:0:((selectedProducts.length/2) | round); let i = index">
              {{product.name}}
            </li>
          </ul>
          <ul class="mt-3" *ngIf="selectedProducts.length > 1">
            <li class="icon mi-arrow_right"
                *ngFor="let product of selectedProducts | slice:((selectedProducts.length/2) | round):selectedProducts.length; let i = index">
              {{product.name}}
            </li>
          </ul>
        </div>
      </div>
    </div>
  </ng-template>
</p-confirmDialog>
